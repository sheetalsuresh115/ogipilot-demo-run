<%# require 'isbm_adaptor'

channel_management_endpoint = 'http://example.com/ChannelManagement'
consumer_publication_endpoint = 'http://example.com/ConsumerPublication'
provider_publication_endpoint = 'http://example.com/ProviderPublication'

uri = 'unique/publication/uri'
topic = 'unique/topic'
message_content = '<message/>'

channel_client = IsbmAdaptor::ChannelManagement.new(channel_management_endpoint)
channel_client.create_channel(uri, :publication)

subscribe_client = IsbmAdaptor::ConsumerPublication.new(consumer_publication_endpoint)
subscribe_session_id = subscribe_client.open_session(uri, [topic])

publish_client = IsbmAdaptor::ProviderPublication.new(provider_publication_endpoint)
publish_session_id = publish_client.open_session(uri)
publish_client.post_publication(publish_session_id, message_content, topic)

message = subscribe_client.read_publication(subscribe_session_id)
puts message.content.to_s

publish_client.close_session(publish_session_id)
subscribe_client.close_session(subscribe_session_id)
channel_client.delete_channel(uri) %>